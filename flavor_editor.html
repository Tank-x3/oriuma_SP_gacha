<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚»ãƒªãƒ•ãƒ‡ãƒ¼ã‚¿ç·¨é›†ãƒ„ãƒ¼ãƒ« (Ver 1.1)</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f4f8; }
        h1 { margin-bottom: 20px; }
        .container { display: flex; gap: 20px; flex-direction: column; }
        .row { display: flex; gap: 20px; }
        
        .import-box { background: #e3f2fd; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #90caf9; }
        .editor-col { flex: 1; background: white; padding: 20px; border-radius: 8px; }
        .output-col { flex: 1; display: flex; flex-direction: column; background: white; padding: 20px; border-radius: 8px; }
        
        .section { margin-bottom: 30px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
        .item-row { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
        input[type="text"] { flex: 1; padding: 5px; }
        button { cursor: pointer; padding: 5px 10px; }
        
        .btn-add { background: #4caf50; color: white; border: none; border-radius: 4px; padding: 8px 16px; }
        .btn-del { background: #f44336; color: white; border: none; border-radius: 4px; }
        .btn-load { background: #ff9800; color: white; border: none; border-radius: 4px; padding: 8px 16px; font-weight: bold; }
        .btn-gen { padding: 15px; font-weight: bold; background: #2196f3; color: white; border: none; border-radius: 8px; margin-bottom: 10px; width: 100%; cursor: pointer; }
        
        textarea { width: 100%; font-family: monospace; border: 1px solid #ccc; border-radius: 4px; padding: 10px; }
        #import-area { height: 100px; margin-bottom: 10px; }
        #output-area { height: 300px; }

        h3 { margin-top: 0; margin-bottom: 10px; font-size: 1rem; color: #555; }
        .cutin-box { border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 4px; background: #fafafa; }
    </style>
</head>
<body>
    <h1>ã‚ªãƒªã‚¦ãƒã‚¬ãƒãƒ£ ã‚»ãƒªãƒ•ç·¨é›†ãƒ„ãƒ¼ãƒ« (Ver 1.1)</h1>

    <div class="import-box">
        <h3 style="margin-top:0;">ğŸ“‚ æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿</h3>
        <p style="font-size:0.9rem; margin-bottom:10px;">ç¾åœ¨ã® <code>flavor_data.js</code> ã®ä¸­èº«ã‚’ã™ã¹ã¦ã‚³ãƒ”ãƒ¼ã—ã¦ã€ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ã€Œèª­ã¿è¾¼ã‚€ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
        <textarea id="import-area" placeholder="// flavor_data.js ã®ã‚³ãƒ¼ãƒ‰ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘..."></textarea>
        <button class="btn-load" onclick="loadCode()">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ç·¨é›†ã«åæ˜ </button>
    </div>

    <div class="row">
        <div class="editor-col">
            <div class="section" id="flavor-section">
                <h2>æœŸå¾…åº¦åˆ¥ã‚»ãƒªãƒ• (FLAVOR_TEXTS)</h2>
                </div>
            
            <div class="section" id="cutin-section">
                <h2>ã‚«ãƒƒãƒˆã‚¤ãƒ³å®šç¾© (SPECIAL_CUTINS)</h2>
                <div id="cutin-list"></div>
                <button class="btn-add" onclick="addCutin()">ï¼‹ æ–°è¦ã‚«ãƒƒãƒˆã‚¤ãƒ³è¿½åŠ </button>
            </div>
        </div>

        <div class="output-col">
            <h2>ğŸ’¾ ä¿å­˜ç”¨ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</h2>
            <p style="font-size:0.9rem;">ç·¨é›†ãŒçµ‚ã‚ã£ãŸã‚‰ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã€<code>flavor_data.js</code> ã«ä¸Šæ›¸ãã—ã¦ãã ã•ã„ã€‚</p>
            <button class="btn-gen" onclick="generateCode()">ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</button>
            <textarea id="output-area" readonly placeholder="ã“ã“ã«ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚"></textarea>
            <button onclick="copyCode()" style="margin-top:10px; padding:10px;">ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼</button>
        </div>
    </div>

    <script>
        // --- ãƒ‡ãƒ¼ã‚¿ä¿æŒç”¨å¤‰æ•° ---
        let flavorData = {
            R: ["TAP TO OPEN"],
            SR: ["ãŠã£ã€ã“ã‚Œã¯â€¦ï¼Ÿ"],
            SSR: ["æ¿€ã‚¢ãƒ„ã§ã™ï¼ï¼"]
        };
        
        let cutinData = [
            { id: "example_id", charName: "ã‚­ãƒ£ãƒ©å", text: "ã‚µãƒ³ãƒ—ãƒ«ã‚»ãƒªãƒ•", image: "" }
        ];

        // --- èª­ã¿è¾¼ã¿å‡¦ç† (Import) ---
        function loadCode() {
            const code = document.getElementById('import-area').value;
            if (!code.trim()) {
                alert("ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚");
                return;
            }

            try {
                // æ­£è¦è¡¨ç¾ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆéƒ¨åˆ†ã‚’æŠ½å‡º
                // const FLAVOR_TEXTS = { ... }; ã®å½¢å¼ã‚’æƒ³å®š
                
                // 1. FLAVOR_TEXTS ã®æŠ½å‡º
                const flavorMatch = code.match(/const FLAVOR_TEXTS = (\{[\s\S]*?\});/);
                if (flavorMatch && flavorMatch[1]) {
                    // JSON.parseã§ã¯ãªãã€new Functionã‚’ä½¿ã£ã¦JSã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦è©•ä¾¡ã™ã‚‹
                    // ã“ã‚Œã«ã‚ˆã‚Šã‚³ãƒ¡ãƒ³ãƒˆã‚„ã‚¯ã‚©ãƒ¼ãƒˆç„¡ã—ã‚­ãƒ¼ã‚‚è¨±å®¹ã•ã‚Œã‚‹
                    flavorData = new Function("return " + flavorMatch[1])();
                } else {
                    console.warn("FLAVOR_TEXTSãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
                }

                // 2. SPECIAL_CUTINS ã®æŠ½å‡º
                const cutinMatch = code.match(/const SPECIAL_CUTINS = (\{[\s\S]*?\});/);
                if (cutinMatch && cutinMatch[1]) {
                    const rawObj = new Function("return " + cutinMatch[1])();
                    
                    // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã‹ã‚‰é…åˆ—å½¢å¼(ã‚¨ãƒ‡ã‚£ã‚¿ç”¨)ã«å¤‰æ›
                    cutinData = Object.keys(rawObj).map(key => {
                        return {
                            id: key,
                            charName: rawObj[key].charName,
                            text: rawObj[key].text,
                            image: rawObj[key].image
                        };
                    });
                } else {
                    console.warn("SPECIAL_CUTINSãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
                }

                // ç”»é¢å†æç”»
                renderFlavor();
                renderCutin();
                alert("èª­ã¿è¾¼ã¿å®Œäº†ï¼\nç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ãŒãƒ•ã‚©ãƒ¼ãƒ ã«åæ˜ ã•ã‚Œã¾ã—ãŸã€‚");

            } catch (e) {
                console.error(e);
                alert("èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n\nã€åŸå› ã®å¯èƒ½æ€§ã€‘\nãƒ»ã‚³ãƒ¼ãƒ‰ã®è²¼ã‚Šä»˜ã‘ç¯„å›²ãŒé–“é•ã£ã¦ã„ã‚‹\nãƒ»æ–‡æ³•ã‚¨ãƒ©ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ã‚‹\n\nã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°(F12)ã§è©³ç´°ã‚’ç¢ºèªã§ãã¾ã™ã€‚");
            }
        }

        // --- æç”»å‡¦ç† ---
        function renderFlavor() {
            const container = document.getElementById('flavor-section');
            container.innerHTML = '<h2>æœŸå¾…åº¦åˆ¥ã‚»ãƒªãƒ•</h2>';
            
            // ãƒ‡ãƒ¼ã‚¿å†…ã«å­˜åœ¨ã™ã‚‹ã‚­ãƒ¼ã‚’æç”»ï¼ˆR, SR, SSRä»¥å¤–ã‚‚ã‚ã‚Œã°è¡¨ç¤ºï¼‰
            Object.keys(flavorData).forEach(rarity => {
                const wrapper = document.createElement('div');
                wrapper.innerHTML = `<h3>${rarity}</h3>`;
                const list = document.createElement('div');
                
                if (!Array.isArray(flavorData[rarity])) flavorData[rarity] = [];

                flavorData[rarity].forEach((text, idx) => {
                    const row = document.createElement('div');
                    row.className = 'item-row';
                    row.innerHTML = `
                        <input type="text" value="${text}" oninput="updateFlavor('${rarity}', ${idx}, this.value)">
                        <button class="btn-del" onclick="delFlavor('${rarity}', ${idx})">å‰Šé™¤</button>
                    `;
                    list.appendChild(row);
                });
                
                const addBtn = document.createElement('button');
                addBtn.className = 'btn-add';
                addBtn.style.fontSize = "0.8rem";
                addBtn.style.marginTop = "5px";
                addBtn.innerText = 'ï¼‹ è¿½åŠ ';
                addBtn.onclick = () => addFlavor(rarity);
                
                wrapper.appendChild(list);
                wrapper.appendChild(addBtn);
                container.appendChild(wrapper);
            });
        }

        function renderCutin() {
            const container = document.getElementById('cutin-list');
            container.innerHTML = '';
            
            cutinData.forEach((item, idx) => {
                const div = document.createElement('div');
                div.className = 'cutin-box';
                div.innerHTML = `
                    <div class="item-row" style="font-weight:bold; color:#555;">ã‚«ãƒƒãƒˆã‚¤ãƒ³ #${idx + 1}</div>
                    <div class="item-row"><span>ID (specialEffect):</span> <input type="text" value="${item.id}" oninput="updateCutin(${idx}, 'id', this.value)"></div>
                    <div class="item-row"><span>ã‚­ãƒ£ãƒ©å:</span> <input type="text" value="${item.charName}" oninput="updateCutin(${idx}, 'charName', this.value)"></div>
                    <div class="item-row"><span>ã‚»ãƒªãƒ•:</span> <input type="text" value="${item.text}" oninput="updateCutin(${idx}, 'text', this.value)"></div>
                    <div class="item-row"><span>ç”»åƒãƒ‘ã‚¹:</span> <input type="text" value="${item.image}" oninput="updateCutin(${idx}, 'image', this.value)"></div>
                    <div style="text-align:right;"><button class="btn-del" onclick="delCutin(${idx})">ã“ã®ã‚«ãƒƒãƒˆã‚¤ãƒ³ã‚’å‰Šé™¤</button></div>
                `;
                container.appendChild(div);
            });
        }

        // --- æ“ä½œç³» ---
        function updateFlavor(rarity, idx, val) { flavorData[rarity][idx] = val; }
        function addFlavor(rarity) { flavorData[rarity].push(""); renderFlavor(); }
        function delFlavor(rarity, idx) { flavorData[rarity].splice(idx, 1); renderFlavor(); }

        function updateCutin(idx, field, val) { cutinData[idx][field] = val; }
        function addCutin() {
            cutinData.push({ id: "new_id", charName: "ã‚­ãƒ£ãƒ©å", text: "ã‚»ãƒªãƒ•", image: "" });
            renderCutin();
        }
        function delCutin(idx) { cutinData.splice(idx, 1); renderCutin(); }

        // --- ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ ---
        function generateCode() {
            // ã‚«ãƒƒãƒˆã‚¤ãƒ³é…åˆ—ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼(IDã‚­ãƒ¼)ã«å¤‰æ›
            let cutinObj = {};
            cutinData.forEach(item => {
                const key = item.id || `unknown_${Math.random().toString(36).slice(2)}`;
                cutinObj[key] = {
                    charName: item.charName,
                    text: item.text,
                    image: item.image
                };
            });

            // å‡ºåŠ›æ™‚ã¯JSONå½¢å¼ã§ç¶ºéº—ã«æ•´å½¢ã™ã‚‹ï¼ˆæ¬¡å›ä»¥é™ã®èª­ã¿è¾¼ã¿ã‚‚å®‰å…¨ï¼‰
            const code = `// flavor_data.js
// ãƒ†ã‚­ã‚¹ãƒˆã€ã‚»ãƒªãƒ•ã€ã‚«ãƒƒãƒˆã‚¤ãƒ³å®šç¾©

// æœŸå¾…åº¦åˆ¥ è¡¨ç´™ã‚»ãƒªãƒ•
const FLAVOR_TEXTS = ${JSON.stringify(flavorData, null, 4)};

// ç‰¹æ®Šã‚«ãƒƒãƒˆã‚¤ãƒ³å®šç¾©
// key: data.js ã® specialEffect ID ã¨ä¸€è‡´ã•ã›ã‚‹
const SPECIAL_CUTINS = ${JSON.stringify(cutinObj, null, 4)};
`;
            document.getElementById('output-area').value = code;
        }

        function copyCode() {
            const el = document.getElementById('output-area');
            el.select();
            document.execCommand('copy');
            alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\nflavor_data.js ã«ä¸Šæ›¸ãã—ã¦ãã ã•ã„ã€‚");
        }

        // åˆæœŸæç”»
        renderFlavor();
        renderCutin();
    </script>
</body>
</html>